#! /bin/sh


########################   D E P L O Y M E  1.0    ####################################

## This script performs deploy applications automatically with the help of Webopse.
## This is the first script where they make the validator component to deploy and
## assign the task to be performed: deploy, undeploy, stop, start.

## by Daniel Gonz√lez Valdivia. <dagonzalv@gmail.com> 
## rights reserved@ 09-MAY-2011


#Use parameters from parametros.conf file

IPWL=`grep IP parametros.conf | cut -d "=" -f 2`
USR=`grep USER parametros.conf | cut -d "=" -f 2`
APP=`grep APP parametros.conf | cut -d "=" -f 2`
CMP=`grep COMP parametros.conf | cut -d "=" -f 2`
CMD=`grep COMD parametros.conf | cut -d "=" -f 2`
WL=`grep WEBLC parametros.conf | cut -d "=" -f 2`

LOC_PATH='/opt/apps/deployme'

echo ${LOC_PATH}


# Create a file only with the component deploy's name.
echo $CMP > componente.txt


# perform the validation of components.
# This part is where you place your app.war (. ear. jar).
# depending on the target of your application, it is as ready to be assembled in your components. 

#carga de listas de componentes


for line in $(cat listnoe.conf);
do
 if [ "${APP}" = "NOE" ]
    then
        if [ "${CMP}" = "${line}" ]
               then
                   # echo $line
                   #export TARGETS="\"managment01,managment02\""
                   export TARGETS="svmnoe01,svmnoe02"
                   echo $TARGETS
        fi
 fi
done

for line in $(cat listsoe.conf);
do
 if [ "${APP}" = "SOE" ]
    then
        if [ "${CMP}" = "${line}" ]
               then
                   #echo $linea
                   export TARGETS="svmsoe01,svmsoe02"
                   echo $TARGETS
        fi
 fi
done

 if [ "${APP}" = "RTWEB" ]
    then
        if [ "${CMP}" = "RTWeb.war" ]
               then
                   export TARGETS="svmrtweb01"
                   echo $TARGETS
        fi
 fi

 if [ "${APP}" = "SIO" ]
    then
        if [ "${CMP}" = "SIORenautWeb.war" ]
               then
                   export TARGETS="svmmau01"
                   echo $TARGETS
        fi
 fi

 if [ "${APP}" = "NEXINDE" ]
    then
        if [ "${CMP}" = "NexInde.war" ]
               then
                   # echo $linea
                   export TARGETS="svmnoe01,svmnoe02"
                   echo $TARGETS
        fi
 fi

for line in $(cat listsiscob.conf);
do
 if [ "${APP}" = "SISCOB" ]
    then
        if [ "${CMP}" = "${line}" ]
               then
                   #echo $linea
                   export TARGETS="svmsco01,svmsco02"
                   echo $TARGETS
        fi
 fi
done


# Realizamos la copia de este archivo generado al servidor donde se deployar√° la aplicaci√≥n para que lo tome otro script

if [ "${WL}" = "weblogic10" ]
 then
     export WL="weblogic10"
     echo $WL
     #scp componente.txt $USR@$IPWL:/opt/apps/wl10mp3/bea/user_projects/domains/wlsnxt/bin/webopse
     #echo "EL ARCHIVO DE COPI√ì SIN PROBLEMAS AL SERVIDOR $IPWL !!!"
       if [ "${CMD}" = "deploy" ]
          then
              # $( /home/danyboy/apps/deployme/startUpWLSPY.sh stop )
              sh ${LOC_PATH}/startUpWLSPY.sh deploy
       fi

       if [ "${CMD}" = "undeploy" ]
          then
              sh ${LOC_PATH}/startUpWLSPY.sh undeploy
       fi

       if [ "${CMD}" = "start" ]
          then
              sh ${LOC_PATH}/startUpWLSPY.sh startapp
       fi

       if [ "${CMD}" = "stop" ]
          then
              sh ${LOC_PATH}/startUpWLSPY.sh stopapp
              #ssh $USR@$IPWL sh /opt/apps/wl10mp3/bea/user_projects/domains/wlsnxt/bin/webopse/startUpWLSPY.sh stopapp
       fi
fi


if [ "${WL}" = "weblogic09" ]
 then

     export WL="weblogic09"
     echo $WL
     #scp componente.txt $USR@$IPWL:/opt/apps/wl9mp2/bea/user_projects/domains/wlsnxt/bin/webopse
     #echo "SE REALIZ√ì LA COPIA AL SERVIDOR $IPWL !!!"

       if [ "${CMD}" = "deploy" ]
          then
             # $( /home/danyboy/apps/pythosn/startUpWLSPY.sh stop )
              sh ${LOC_PATH}/startUpWL09SPY.sh deploy
       fi

       if [ "${CMD}" = "undeploy" ]
          then
             sh ${LOC_PATH}/startUpWL09SPY.sh undeploy
       fi

       if [ "${CMD}" = "start" ]
          then
             sh ${LOC_PATH}/startUpWL09SPY.sh startapp 
       fi

       if [ "${CMD}" = "stop" ]
          then
             sh ${LOC_PATH}/startUpWL09SPY.sh stopapp
       fi
fi
